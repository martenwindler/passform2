@use "sass:color";
@use '../base/variables' as *;

// --- SIDEBAR ORGANISM ---
// High-Fidelity Steuereinheit (Rail + Drawer)

.sidebar-container {
    display: flex;
    height: 100%;
    background: $color-bg-main;
    border-left: 1px solid rgba(255, 255, 255, 0.05);
    flex-shrink: 0;
    position: relative;
    overflow: hidden; 
}

// 1. Navigation Rail (Icon-Leiste)
.sidebar-rail {
    width: $rail-width;
    background: $color-rail-bg;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: $space-lg 0;
    gap: $space-md;
    border-right: 1px solid rgba(0, 0, 0, 0.2);
    z-index: 20;
    flex-shrink: 0;
}

// 2. Content Drawer
.sidebar-content {
    width: $drawer-width;
    background: $color-drawer-bg;
    display: flex;
    flex-direction: column;
    box-shadow: $shadow-lg;
    z-index: 10;
    animation: slideIn $transition-speed $transition-curve;

    .sidebar-tab-header {
        padding: 0;
        background: rgba(0, 0, 0, 0.1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        flex-shrink: 0;

        h2 {
            padding: $space-lg;
            font-size: 1.1rem;
            font-weight: 600;
            color: $color-info; 
            letter-spacing: 0.5px;
            margin: 0;
        }
    }

    .tab-body {
        flex: 1;
        display: flex;           
        flex-direction: column;  
        overflow-y: hidden;      
        padding: $space-lg 0; 
    }
}

// 3. Modulare Sektionen
.sidebar-section {
    width: 100%;
    padding: 0;
    margin-bottom: $space-xl;
    flex-shrink: 0;

    h3 {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: $text-muted;
        letter-spacing: 1.2px;
        margin-bottom: $space-md;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding: 0 $space-lg $space-xs $space-lg;
    }

    // Standard-Inhalt mit Padding
    > div, > p, > span,
    .nested-box, .nested-settings, .actions-compact-grid,
    .coord-item, .parameter-grid-row, .status-grid {
        padding-left: $space-lg;
        padding-right: $space-lg;
    }

    .coord-item {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;

        .icon-container {
            display: flex; /* Zentriert das SVG im Container */
        }
    }

    // --- NEU: SPEZIELLE SIDEBAR ELEMENTE ---

    // Lade-Indikator (Pfadplanung)
    .planning-status-box {
        display: flex;
        align-items: center;
        gap: $space-sm;
        margin-bottom: $space-md;
        color: $color-info;
        font-size: 0.85rem;

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba($color-info, 0.2);
            border-top-color: $color-info;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
    }

    .btn-sidebar-primary {
        width: 100%;
        background-color: $color-info;
        color: white;
        padding: $space-sm;
        border-radius: $border-radius-sm;
        font-weight: 600;
        margin-top: $space-sm;
        
        // FIX: lighten -> color.adjust
        &:hover:not(:disabled) { 
            background-color: color.adjust($color-info, $lightness: 10%); 
        }
    }

    .btn-sidebar-ranger {
        width: 100%;
        background-color: $color-warning;
        color: $text-dark;
        padding: $space-sm;
        border-radius: $border-radius-sm;
        font-weight: 700;
        
        // FIX: lighten -> color.adjust
        &:hover:not(:disabled) { 
            background-color: color.adjust($color-warning, $lightness: 10%); 
        }
    }

    .btn-disabled {
        opacity: 0.4;
        cursor: not-allowed;
        filter: grayscale(1);
    }

    // Hardware Status Values
    .status-item .value {
        &.online { color: $color-success; font-weight: 600; }
        &.offline { color: $color-danger; }
    }

    // --- SYSTEM-HISTORIE (FILL-LOGIK) ---
    &.fill {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-bottom: 0;
        min-height: 0;

        .log-container {
            flex: 1;
            overflow-y: auto;
            padding: 0; 

            .log-entry {
                display: flex;
                align-items: flex-start;
                gap: $space-sm;
                padding: $space-xs $space-lg; 
                border-bottom: 1px solid rgba(255, 255, 255, 0.02);
                font-family: 'Cascadia Code', 'Fira Code', monospace;
                font-size: 0.8rem;
                line-height: 1.4;
                transition: background-color $transition-speed;

                &:hover { background-color: rgba(255, 255, 255, 0.03); }

                &.warning { color: $color-warning; .log-dot { background: $color-warning; } }
                &.error   { color: $color-danger;  .log-dot { background: $color-danger; } }
                &.success { color: $color-success; .log-dot { background: $color-success; } }

                .log-dot {
                    width: 6px;
                    height: 6px;
                    border-radius: 50%;
                    background: $text-muted;
                    margin-top: 6px;
                    flex-shrink: 0;
                }
            }

            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
            &::-webkit-scrollbar { width: 4px; }
            &::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); }
        }
    }

    hr {
        border: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        margin: $space-md 0;
        width: 100%;
    }
}

// --- ANIMATIONEN ---
@keyframes slideIn {
    from { opacity: 0; transform: translateX(15px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}